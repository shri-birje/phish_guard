<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>PhishGuard Admin - Logs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS (CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Plotly JS (CDN) -->
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>

    <style>
        body {
            padding-top: 1.5rem;
            padding-bottom: 2rem;
        }

        .risk-badge-High {
            background-color: #dc3545;
        }

        .risk-badge-Medium {
            background-color: #ffc107;
            color: #212529;
        }

        .risk-badge-Low {
            background-color: #28a745;
        }
    </style>
</head>

<body class="bg-light">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="h3">PhishGuard Admin - Recent Logs</h1>
            <div>
                <a href="/admin/blacklist" class="btn btn-outline-secondary btn-sm">
                    View Blacklist
                </a>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="row mb-4">
            <div class="col-md-3 mb-2">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title mb-1">Total Logs</h5>
                        <p class="display-6 mb-0">{{ total_logs }}</p>
                    </div>
                </div>
            </div>
            <!-- You can add more cards later if you want -->
        </div>

        <!-- Chart -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">Logs by Risk Level</h5>
                        <div id="risk-chart" style="height: 300px;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logs Table -->
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title mb-3">Last {{ logs|length }} Scans</h5>
                <div class="table-responsive">
                    <table class="table table-sm table-striped align-middle">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">Time (UTC)</th>
                                <th scope="col">User / Session</th>
                                <th scope="col">URL</th>
                                <th scope="col" class="text-end">Phishing Score</th>
                                <th scope="col">Risk Level</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for log in logs %}
                            <tr>
                                <td style="white-space: nowrap;">
                                    {{ log.ts }}
                                </td>
                                <td style="white-space: nowrap;">
                                    {{ log.session_id }}
                                </td>
                                <td style="max-width: 420px; word-break: break-all;">
                                    {{ log.url }}
                                </td>
                                <td class="text-end">
                                    {{ "%.2f"|format(log.phishing_score) }}
                                </td>
                                <td>
                                    <span class="badge risk-badge-{{ log.risk_level }}">
                                        {{ log.risk_level }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                            {% if logs|length == 0 %}
                            <tr>
                                <td colspan="5" class="text-center text-muted py-3">
                                    No logs yet.
                                </td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

<script>
    (function () {
        const labels = JSON.parse('{{ risk_labels | safe }}');
        const values = JSON.parse('{{ risk_values | safe }}');

        const data = [{
            x: labels,
            y: values,
            type: 'bar'
        }];

        const layout = {
            margin: { t: 30 },
            yaxis: { title: "Count" }
        };

        Plotly.newPlot('risk-chart', data, layout, { displayModeBar: false });
    })();
</script>

</body>

</html>