<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>PhishGuard Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap (CDN) -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >

  <style>
    body {
      min-height: 100vh;
      background: radial-gradient(circle at top left, #0d6efd 0, #020617 45%, #000 100%);
      color: #f8fafc;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    .glass-card {
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(16px);
      border-radius: 1.5rem;
      border: 1px solid rgba(148, 163, 184, 0.3);
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.7);
    }
    .brand-badge {
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      border-radius: 999px;
      padding: 0.35rem 0.9rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: .08em;
      display: inline-flex;
      align-items: center;
      gap: .4rem;
      color: #020617;
    }
    .brand-badge span.icon {
      display: inline-flex;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: rgba(15, 23, 42, .1);
      align-items: center;
      justify-content: center;
      font-size: .9rem;
    }
    .btn-gradient {
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      border: none;
      font-weight: 600;
      box-shadow: 0 10px 25px rgba(34, 197, 94, .4);
    }
    .btn-gradient:hover {
      filter: brightness(1.05);
      box-shadow: 0 12px 30px rgba(34, 197, 94, .6);
    }
    .form-control {
      background-color: #020617;
      border-color: rgba(148, 163, 184, .4);
      color: #e5e7eb;
    }
    .form-control:focus {
      border-color: #22c55e;
      box-shadow: 0 0 0 1px rgba(34, 197, 94, .7);
      background-color: #020617;
      color: #e5e7eb;
    }
    .input-label {
      font-size: .85rem;
      font-weight: 500;
      color: #9ca3af;
    }
    .status-text {
      font-size: 0.85rem;
      min-height: 1.3rem;
    }
    .link {
      color: #38bdf8;
      cursor: pointer;
    }
    .link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container px-3">
    <div class="row justify-content-center">
      <div class="col-12 col-md-7 col-lg-5">
        <div class="glass-card p-4 p-md-5 mt-3">
          <div class="mb-3 text-center">
            <div class="brand-badge mb-3">
              <span class="icon">üõ°Ô∏è</span>
              <span>PhishGuard</span>
            </div>
            <h1 class="h4 mb-1">Welcome back</h1>
            <p class="text-muted mb-0" style="font-size:.9rem;">
              Sign in to see your phishing checks and behavior profile.
            </p>
          </div>

          <form id="auth-form" class="mt-4">
            <input type="hidden" id="mode" value="login">
            <div class="mb-3">
              <label for="email" class="input-label mb-1">Email</label>
              <input type="email" class="form-control form-control-lg" id="email"
                     placeholder="you@example.com" required>
            </div>

            <div class="mb-2">
              <label for="password" class="input-label mb-1">Password</label>
              <input type="password" class="form-control form-control-lg" id="password"
                     placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6" required>
            </div>

            <div class="d-flex justify-content-between align-items-center mb-3">
              <small id="status" class="status-text text-warning"></small>
            </div>

            <button type="submit" class="btn btn-gradient w-100 btn-lg mb-3" id="submit-btn">
              Sign in
            </button>

            <div class="text-center text-muted" style="font-size:.9rem;">
              <span id="toggle-text">
                New here? <span class="link" id="toggle-link">Create an account</span>
              </span>
            </div>

            <div class="text-center mt-3" style="font-size:.8rem;">
              <span class="text-muted">After login, your mobile app should use this token in the <code>Authorization</code> header.</span>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    const form = document.getElementById("auth-form");
    const statusEl = document.getElementById("status");
    const submitBtn = document.getElementById("submit-btn");
    const toggleText = document.getElementById("toggle-text");
    const modeInput = document.getElementById("mode");

    function setMode(mode) {
      modeInput.value = mode;
      if (mode === "login") {
        submitBtn.textContent = "Sign in";
        toggleText.innerHTML = 'New here? <span class="link" id="toggle-link">Create an account</span>';
      } else {
        submitBtn.textContent = "Create account";
        toggleText.innerHTML = 'Already have an account? <span class="link" id="toggle-link">Sign in</span>';
      }
      // Reattach handler after updating innerHTML
      document.getElementById("toggle-link").onclick = () => {
        setMode(mode === "login" ? "register" : "login");
      };
    }

    // Initial toggle link attach
    document.addEventListener("DOMContentLoaded", () => {
      const tl = document.getElementById("toggle-link");
      if (tl) {
        tl.onclick = () => setMode("register");
      }
    });

    async function callApi(path, body) {
      const resp = await fetch(path, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(body)
      });
      const data = await resp.json().catch(() => ({}));
      if (!resp.ok || data.ok === false) {
        throw new Error(data.error || ("HTTP " + resp.status));
      }
      return data;
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusEl.textContent = "";
      submitBtn.disabled = true;

      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;

      const mode = modeInput.value;
      const endpoint = mode === "login" ? "/api/login" : "/api/register";

      try {
        const result = await callApi(endpoint, { email, password });
        statusEl.classList.remove("text-warning", "text-danger");
        statusEl.classList.add("text-success");
        statusEl.textContent = mode === "login" ? "Login successful ‚úì" : "Account created ‚úì";

        // Store token & email for web and mobile client
        if (result.token) {
          localStorage.setItem("phishguard_token", result.token);
          localStorage.setItem("phishguard_email", result.email || email);
        }

        // ‚úÖ After login, go to main UI (/)
        setTimeout(() => {
          window.location.href = "/";
        }, 600);
      } catch (err) {
        statusEl.classList.remove("text-success");
        statusEl.classList.add("text-danger");
        statusEl.textContent = err.message || "Something went wrong";
      } finally {
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
